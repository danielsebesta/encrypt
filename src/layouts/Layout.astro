---
import '../styles/global.css'
import { getTranslations, t, languages, locales, getLocalePath, type Locale } from '../lib/i18n';
import { getNavCategories } from '../lib/tools';

type Props = {
  title?: string;
  description?: string;
  ogImage?: string;
  canonical?: string;
};

const locale = (Astro.currentLocale ?? 'en') as Locale;
const dict = getTranslations(locale);

const {
  title = t(dict, 'meta.defaultTitle'),
  description = t(dict, 'meta.defaultDescription'),
  ogImage = "/encryptclick.svg",
  canonical,
} = Astro.props;

const canonicalUrl = canonical || new URL(Astro.url.pathname, "https://encrypt.click").href;
const path = Astro.url.pathname;
const currentLang = languages[locale];

const navCategories = getNavCategories(t, dict);
const privacyCat = navCategories.find(c => c.name === t(dict, 'nav.privacy'));
if (privacyCat) {
  privacyCat.tools.push({ label: t(dict, 'nav.tool.deadDrop'), href: '/drop' });
}

const languageOptions = locales.map(l => ({
  code: l,
  name: languages[l].name,
  flag: languages[l].flag,
  href: getLocalePath(path, l),
  active: l === locale
}));
---

<!doctype html>
<html lang={locale} class="notranslate scroll-smooth">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="google" content="notranslate" />
		<meta name="format-detection" content="telephone=no" />
		<title>{title}</title>
		<meta name="description" content={description} />
		<link rel="canonical" href={canonicalUrl} />
		<meta property="og:type" content="website" />
		<meta property="og:url" content={canonicalUrl} />
		<meta property="og:title" content={title} />
		<meta property="og:description" content={description} />
		<meta property="og:image" content={ogImage} />
		<meta property="og:site_name" content="encrypt.click" />
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:title" content={title} />
		<meta name="twitter:description" content={description} />
		<meta name="twitter:image" content={ogImage} />
		<meta name="theme-color" content="#10b981" />
		<meta name="robots" content="index, follow" />
		<link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<link rel="shortcut icon" href="/favicon.ico" />
		<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
		<meta name="apple-mobile-web-app-title" content="encrypt.click" />
		<link rel="manifest" href="/site.webmanifest" />
		<meta name="generator" content={Astro.generator} />
		<script is:inline>
			(function(){try{var t=localStorage.getItem('theme');if(t==='dark'||(!t&&matchMedia('(prefers-color-scheme:dark)').matches))document.documentElement.classList.add('dark')}catch(e){}})();
			if('serviceWorker' in navigator){navigator.serviceWorker.register('/sw.js');}
		</script>
	</head>
	<body>
		<nav class="border-b border-zinc-200 dark:border-zinc-800 bg-white/95 dark:bg-zinc-950/95 backdrop-blur-xl sticky top-0 z-50 shadow-sm dark:shadow-none">
			<div class="max-w-7xl mx-auto px-5 flex items-center justify-between h-16">
				<a href={locale === 'en' ? '/' : `/${locale}/`} class="flex items-center gap-3 shrink-0 rounded-lg py-1.5 pr-2 -ml-2 hover:bg-zinc-100 dark:hover:bg-zinc-800/50 transition-colors">
					<img src="/encryptclick_icon.svg" alt="" class="h-8 w-auto" />
					<span class="text-base font-mono font-bold tracking-tight text-zinc-900 dark:text-zinc-100">encrypt.click</span>
				</a>

				<div class="hidden md:flex items-center gap-2">
					<div class="flex items-center gap-0.5 rounded-full bg-zinc-100/80 dark:bg-zinc-800/50 p-1">
						{navCategories.map((cat) => (
							<div class="relative group">
								<button class="rounded-full text-xs font-semibold px-4 py-2 flex items-center gap-2 text-zinc-600 dark:text-zinc-400 hover:text-zinc-900 dark:hover:text-zinc-100 hover:bg-white dark:hover:bg-zinc-700/50 transition-all">
									{cat.name}
									<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="transition-transform group-hover:rotate-180 shrink-0"><polyline points="6 9 12 15 18 9"/></svg>
								</button>
								<div class="absolute top-full left-0 pt-2 opacity-0 translate-y-2 pointer-events-none group-hover:opacity-100 group-hover:translate-y-0 group-hover:pointer-events-auto group-focus-within:opacity-100 group-focus-within:translate-y-0 group-focus-within:pointer-events-auto transition-all duration-200 z-[60]">
									<div class="w-52 bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-700 rounded-2xl shadow-xl p-2.5 grid gap-0.5">
										{cat.tools.map((tool) => (
											<a href={tool.href} class="px-3 py-2.5 text-xs font-bold text-zinc-500 dark:text-zinc-400 hover:text-emerald-500 hover:bg-emerald-50/50 dark:hover:bg-emerald-400/5 rounded-xl transition-all">
												{tool.label}
											</a>
										))}
									</div>
								</div>
							</div>
						))}
					</div>

					<div class="h-6 w-px bg-zinc-200 dark:bg-zinc-700 mx-1"></div>

					<div class="flex items-center gap-1">
						<a
							href="https://github.com/danielsebesta/encrypt.click"
							target="_blank"
							rel="noopener noreferrer"
							class="btn-ghost btn-icon rounded-full p-2.5 hover:bg-zinc-100 dark:hover:bg-zinc-800"
							aria-label="GitHub"
						>
							<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
						</a>
						<button
							id="theme-toggle"
							type="button"
							class="btn-ghost btn-icon rounded-full p-2.5 hover:bg-zinc-100 dark:hover:bg-zinc-800"
							aria-label={t(dict, 'nav.toggleTheme')}
						>
							<span class="block dark:hidden">
								<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
							</span>
							<span class="hidden dark:block">
								<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
							</span>
						</button>
						<div class="relative group">
							<button class="flex items-center gap-1.5 rounded-full bg-zinc-100/80 dark:bg-zinc-800/60 px-3 py-1.5 text-[11px] font-semibold uppercase tracking-widest hover:bg-zinc-200 dark:hover:bg-zinc-700 transition-colors">
								<span>{currentLang.flag}</span>
								<span>{currentLang.name}</span>
								<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="transition-transform group-hover:rotate-180"><polyline points="6 9 12 15 18 9"/></svg>
							</button>
							<div class="absolute top-full right-0 pt-2 opacity-0 translate-y-2 pointer-events-none group-hover:opacity-100 group-hover:translate-y-0 group-hover:pointer-events-auto group-focus-within:opacity-100 group-focus-within:translate-y-0 group-focus-within:pointer-events-auto transition-all duration-200 z-[60]">
								<div class="w-44 bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-700 rounded-2xl shadow-xl p-2 grid gap-0.5">
									{languageOptions.map((lang) => (
										<a
											href={lang.href}
											class={`px-3 py-2 text-xs font-bold rounded-xl transition-all flex items-center gap-2 ${lang.active ? 'bg-emerald-50 dark:bg-emerald-400/10 text-emerald-600 dark:text-emerald-400' : 'text-zinc-500 dark:text-zinc-400 hover:text-emerald-500 hover:bg-emerald-50/50 dark:hover:bg-emerald-400/5'}`}
										>
											<span>{lang.flag}</span>
											<span>{lang.name}</span>
										</a>
									))}
								</div>
							</div>
						</div>
					</div>
				</div>

				<div class="flex md:hidden items-center gap-1">
					<button
						id="theme-toggle-mobile"
						type="button"
						class="btn-ghost btn-icon rounded-full p-2.5 hover:bg-zinc-100 dark:hover:bg-zinc-800"
						aria-label={t(dict, 'nav.toggleTheme')}
					>
						<span class="block dark:hidden">
							<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
						</span>
						<span class="hidden dark:block">
							<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
						</span>
					</button>
					<div class="relative group">
						<button class="flex items-center gap-1 rounded-full bg-zinc-100/80 dark:bg-zinc-800/60 px-2.5 py-1 text-[10px] font-semibold uppercase tracking-widest">
							<span>{currentLang.flag}</span>
							<svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="transition-transform group-hover:rotate-180"><polyline points="6 9 12 15 18 9"/></svg>
						</button>
						<div class="absolute top-full right-0 pt-2 opacity-0 translate-y-2 pointer-events-none group-hover:opacity-100 group-hover:translate-y-0 group-hover:pointer-events-auto group-focus-within:opacity-100 group-focus-within:translate-y-0 group-focus-within:pointer-events-auto transition-all duration-200 z-[60]">
							<div class="w-40 bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-700 rounded-2xl shadow-xl p-2 grid gap-0.5">
								{languageOptions.map((lang) => (
									<a
										href={lang.href}
										class={`px-3 py-2 text-xs font-bold rounded-xl transition-all flex items-center gap-2 ${lang.active ? 'bg-emerald-50 dark:bg-emerald-400/10 text-emerald-600 dark:text-emerald-400' : 'text-zinc-500 dark:text-zinc-400 hover:text-emerald-500 hover:bg-emerald-50/50 dark:hover:bg-emerald-400/5'}`}
									>
										<span>{lang.flag}</span>
										<span>{lang.name}</span>
									</a>
								))}
							</div>
						</div>
					</div>
					<button id="mobile-menu-toggle" type="button" class="btn-ghost btn-icon rounded-full p-2.5" aria-label={t(dict, 'nav.menu')}>
						<span class="block" data-menu-icon="open">
							<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" y1="12" x2="20" y2="12"/><line x1="4" y1="6" x2="20" y2="6"/><line x1="4" y1="18" x2="20" y2="18"/></svg>
						</span>
						<span class="hidden" data-menu-icon="close">
							<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
						</span>
					</button>
				</div>
			</div>

			<div id="mobile-menu" class="md:hidden border-t border-zinc-200 dark:border-zinc-800 max-h-[80vh] overflow-y-auto bg-white dark:bg-zinc-950 hidden">
				<div class="p-5 space-y-6">
					{navCategories.map((cat) => (
						<div class="space-y-3">
							<h3 class="text-[10px] font-black uppercase text-zinc-400 tracking-widest">{cat.name}</h3>
							<div class="grid grid-cols-2 gap-2">
								{cat.tools.map((tool) => (
									<a href={tool.href} class="block py-2 text-xs font-bold text-zinc-700 dark:text-zinc-300 hover:text-emerald-500 transition-colors uppercase">{tool.label}</a>
								))}
							</div>
						</div>
					))}
					<div class="pt-4 border-t border-zinc-100 dark:border-zinc-900">
						<a href="https://github.com/danielsebesta/encrypt.click" target="_blank" rel="noopener noreferrer" class="block py-2 text-sm font-bold text-zinc-600 dark:text-zinc-300">{t(dict, 'nav.github')}</a>
					</div>
				</div>
			</div>
		</nav>

		<main class="flex-1">
			<slot />
		</main>
		<script is:inline>
			(function () {
				if (typeof window === 'undefined' || typeof document === 'undefined') return;

				if ('IntersectionObserver' in window) {
					var observer = new IntersectionObserver(function (entries) {
						entries.forEach(function (entry) {
							if (entry.isIntersecting) {
								entry.target.classList.add('aos-visible');
								observer.unobserve(entry.target);
							}
						});
					}, { threshold: 0.1 });

					document.querySelectorAll('[data-aos]').forEach(function (el) {
						el.classList.add('aos-fade');
						var delay = el.getAttribute('data-aos-delay');
						if (delay) el.classList.add('delay-' + delay);
						observer.observe(el);
					});
				} else {
					document.querySelectorAll('[data-aos]').forEach(function (el) {
						el.classList.add('aos-visible');
					});
				}

				var main = document.querySelector('main');
				if (main) {
					main.classList.add('page-enter');
					requestAnimationFrame(function () {
						main.classList.add('page-enter-active');
					});
				}

				document.addEventListener('click', function (event) {
					var anchor = event.target.closest && event.target.closest('a');
					if (!anchor) return;
					var href = anchor.getAttribute('href');
					var target = anchor.getAttribute('target');
					if (!href || href.indexOf('http') === 0 || href.indexOf('#') === 0 || target === '_blank') return;
					if (event.metaKey || event.ctrlKey || event.shiftKey || event.altKey || event.button !== 0) return;
					event.preventDefault();
					var mainEl = document.querySelector('main');
					if (!mainEl) { window.location.href = href; return; }
					mainEl.classList.add('page-exit');
					var navigated = false;
					var go = function () { if (navigated) return; navigated = true; window.location.href = href; };
					mainEl.addEventListener('transitionend', function handle(e) { if (e.target !== mainEl) return; mainEl.removeEventListener('transitionend', handle); go(); });
					setTimeout(go, 400);
				});

				function bindThemeToggle(id) {
					var btn = document.getElementById(id);
					if (!btn) return;
					btn.addEventListener('click', function () {
						var isDark = document.documentElement.classList.toggle('dark');
						try { localStorage.setItem('theme', isDark ? 'dark' : 'light'); } catch (e) {}
					});
				}
				bindThemeToggle('theme-toggle');
				bindThemeToggle('theme-toggle-mobile');

				var menuBtn = document.getElementById('mobile-menu-toggle');
				var menu = document.getElementById('mobile-menu');
				if (menuBtn && menu) {
					menuBtn.addEventListener('click', function () {
						var isHidden = menu.classList.contains('hidden');
						menu.classList.toggle('hidden', !isHidden);
						var openIcon = menuBtn.querySelector('[data-menu-icon="open"]');
						var closeIcon = menuBtn.querySelector('[data-menu-icon="close"]');
						if (openIcon && closeIcon) {
							openIcon.classList.toggle('hidden', !isHidden);
							closeIcon.classList.toggle('hidden', isHidden);
						}
					});
				}
			})();
		</script>
	</body>
</html>
